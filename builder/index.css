/* ===== スペーシング変数定義 ===== */
    :root {
        --spacing-section: 0.75rem;  /* セクション間の統一間隔 */
        --spacing-element: 1rem;     /* 要素間の標準間隔 */
    }

    /* 基本スタイル */
    body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
        line-height: 1.5;
        margin: 0;
        padding: 0;
        background-color: #f5f5f5;
        color: #000;
    }

    /* ライトモード：リンクのデフォルト */
    a {
        color: #007bff;
    }

    a:hover {
        color: #0056b3;
    }
    
    /* PCブラウザ向けIME抑止（対応ブラウザのみ） */
    #models,
    #package-search,
    #package-search-autocomplete input.package-search,
    #command,
    #commands-autocomplete input.command {
        ime-mode: disabled;
    }

    /* 公式互換のオートコンプリート */
    #models-autocomplete {
        display: flex;
        padding-top: 0;
    }
    
    .container {
        max-width: 720px;
        margin: 0 auto;
        padding: 0 1rem;
    }

    /* ===== 構造的スペーシング管理 ===== */
    .container > * {
        margin-bottom: var(--spacing-section);
    }
    
    .container > *:last-child {
        margin-bottom: 0;
    }
    
    #packages > * {
        margin-bottom: var(--spacing-section);
    }
    
    #packages > *:last-child {
        margin-bottom: 0;
    }

    h1 {
        font-size: 2.5rem;
        font-weight: 300;
        text-align: center;
        margin-bottom: 1rem;
        color: #007bff;
    }

    .lead {
        font-size: 1.25rem;
        font-weight: 300;
        text-align: center;
        margin-bottom: 2rem;
        color: #6c757d;
    }
    
    .autocomplete {
        position: relative;
        flex-grow: 1;
    }
    
    #models {
        border: 0.06rem solid transparent;
        background-color: #f1f1f1;
        padding: 0.8rem;
        flex-grow: 1;
        margin-right: 0.3125rem;
        border-radius: 0.2rem;
        font-size: inherit;
        color: #495057;
    }
    
    #versions {
        border: 0.06rem solid transparent;
        background-color: #f1f1f1;
        padding: 0.8rem;
        min-width: 8rem;
        border-radius: 0.25rem;
        font-size: inherit;
        color: #495057;
    }

    .autocomplete-items {
        position: absolute;
        border: 1px solid #d4d4d4;
        border-bottom: none;
        border-top: none;
        z-index: 999;
        top: 100%;
        left: 0;
        right: 0;
        max-height: 18.75rem;
        overflow-y: auto;
        background-color: #fff;
    }

    .autocomplete-items div {
        padding: 0.625rem;
        cursor: pointer;
        background-color: #fff;
        border-bottom: 1px solid #d4d4d4;
    }

    .autocomplete-items div:hover {
        background-color: #e9ecef;
    }

    .autocomplete-active {
        background-color: #00a3e1 !important;
        color: #ffffff;
    }

    /* フォーム要素 */
    .form-group {
        margin-bottom: var(--spacing-element);
    }

    label {
        display: inline-block;
        margin-bottom: 0.5rem;
        font-weight: 500;
    }

    .form-control {
        display: block;
        width: 100%;
        padding: 0.75rem;
        font-size: 1rem;
        font-weight: 400;
        line-height: 1.25;
        color: #495057;
        background-color: #f1f1f1;
        border: 1px solid #dee2e6;
        border-radius: 0.25rem;
        transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        box-sizing: border-box;
    }

    .form-control:not(textarea) {
        height: 2.75rem;
    }

    textarea.form-control {
        height: auto;
    }
    
    .form-control:focus {
        color: #495057;
        background-color: #fff;
        border-color: #007bff;
        outline: 0;
        box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
    }

    .form-control:disabled {
        background-color: #e9ecef;
        color: #495057;
        opacity: 1;
    }

    /* Info/Status ボックス */
    .info {
        background-color: #d1ecf1;
        border: 1px solid #bee5eb;
        color: #0c5460;
        padding: 0.75rem 1.25rem;
        border-radius: 0.25rem;
    }

    .asu-info {
        background-color: #d1ecf1;
        border: 1px solid #bee5eb;
        color: #0c5460;
        padding: 1rem;
        margin: 1rem 0;
        border-radius: 0.25rem;
    }

    .asu-error {
        background-color: #f8d7da;
        border: 1px solid #f5c6cb;
        color: #721c24;
        padding: 1rem;
        margin: 1rem 0;
        border-radius: 0.25rem;
    }

    /* パッケージセクション */
    .packages {
        margin: 0;  /* 構造に従う */
    }
    
    /* ボタン/リンク */
    .btn {
        display: inline-block;
        font-weight: 400;
        color: #212529;
        text-align: center;
        cursor: pointer;
        background-color: transparent;
        border: 1px solid transparent;
        padding: 0.375rem 0.75rem;
        font-size: 1rem;
        line-height: 1.5;
        border-radius: 0.25rem;
        transition: all 0.15s ease-in-out;
        text-decoration: none;
        box-shadow: 0 0.06rem 0.3rem 0 rgba(0, 0, 0, 0.2),
                    0 0.125rem 0.125rem 0 rgba(0, 0, 0, 0.14),
                    0 0.19rem 0.06rem -0.125rem rgba(0, 0, 0, 0.12);
    }

    .btn-primary {
        color: #fff;
        background-color: #00a3e1;
        border-color: #00a3e1;
    }

    .btn-primary:hover {
        color: #fff;
        background-color: #038fc6;
        border-color: #038fc6;
    }

    .btn-primary:disabled {
        color: #fff;
        background-color: #00a3e1;
        border-color: #00a3e1;
        opacity: 0.65;
    }

    .custom-link,
    .download-link {
        text-decoration: none;
        border-radius: 0.2rem;
        padding: 0.8rem;
        margin: 0;  /* 構造に従う、特別なマージンなし */
        font-size: inherit;
        cursor: pointer;
        letter-spacing: 0.05rem;
        display: inline-flex;
        align-items: center;
        line-height: 1;
        box-shadow: 0 0.06rem 0.3rem 0 rgba(0, 0, 0, 0.2),
                    0 0.125rem 0.125rem 0 rgba(0, 0, 0, 0.14),
                    0 0.19rem 0.06rem -0.125rem rgba(0, 0, 0, 0.12);
        color: #fff;
        background-color: #00a3e1;
        width: max-content;
    }

    .custom-link:hover,
    .download-link:hover {
        background-color: #038fc6;
        color: #fff;
    }

    .custom-link > :first-child,
    .download-link > :first-child {
        height: 1rem;
        width: auto;
        margin-top: 0;
        margin-right: 0.9375rem;
        content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM12 7a1 1 0 0 1 1 1v4h3l-4 4-4-4h3V8a1 1 0 0 1 1-1z' fill='%23fff'/%3E%3C/svg%3E");
    }

    /* カスタムセクション */
    .aios-section {
        margin: 0;
        padding: 1rem;
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 0.25rem;
    }
    
    /* ===== 内部要素の構造的管理 ===== */
    #package-selector-config > *,
    #aios-config > * {
        margin-bottom: var(--spacing-section);
    }
    
    #package-selector-config > *:last-child,
    #aios-config > *:last-child {
        margin-bottom: 0;
    }
    
    .form-row {
        display: flex;
        flex-wrap: wrap;
        margin-right: -0.3125rem;
        margin-left: -0.3125rem;
    }

    .form-row > .form-group {
        padding-right: 0.3125rem;
        padding-left: 0.3125rem;
        flex: 1;
    }

    .radio-group {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
    }

    .form-check {
        position: relative;
        display: block;
        padding-left: 1.25rem;
    }

    .form-check-input {
        position: absolute;
        margin-top: 0.3rem;
        margin-left: -1.25rem;
    }

    .form-check-label {
        margin-bottom: 0;
    }

    .conditional-section {
        padding: 1rem;
        background-color: #fff3cd;
        border: 1px solid #ffeaa7;
        border-radius: 0.25rem;
        display: none;
    }

    h5.section-title {
        font-size: 1rem;
        font-weight: 500;
        margin-top: 0;
        margin-bottom: 0.75rem;
        color: #495057;
    }
    
    .text-muted {
        color: #6c757d;
    }

    .small {
        font-size: 0.875rem;
    }

    /* プログレス表示 */
    .build-progress {
        margin: 1rem 0;
        padding: 1rem;
        background-color: inherit;
        border: 1px solid #2196f3;
        border-radius: 0.25rem;
        display: none;
    }

    .progress {
        width: 100%;
        height: 1rem;
        background-color: #e9ecef;
        border-radius: 0.25rem;
        overflow: hidden;
        margin-top: 0.5rem;
    }

    .progress-bar {
        height: 100%;
        background-color: #007bff;
        transition: width 0.3s ease;
    }

/* パッケージセクション - 抜本修正 */
    .package-category {
        margin: 0;  /* 構造に従う */
        padding: 1rem;  /* 上下左右統一パディング */
        background-color: #fff;
        border: 1px solid #e9ecef;
        border-radius: 0.25rem;
        display: flex;
        flex-direction: column;
        min-height: fit-content;  /* 最小高さを内容に合わせる */
    }

    /* package-category内のh4は枠なし */
    .package-category h4 {
        margin: 0 0 1rem 0;  /* 下マージンのみ */
        padding: 0;
        background-color: transparent;
        border: none;
        font-size: 1.1rem;
        font-weight: 500;
    }
    
    /* 独立したh4（旧スタイル）は削除または別クラスに */
    h4.standalone {
        margin: 0;
        padding: 0.75rem 1rem;
        background-color: #fff;
        border: 1px solid #e9ecef;
        border-radius: 0.25rem;
        font-size: 1.1rem;
        font-weight: 500;
    }

    .package-category-description {
        font-size: 0.9rem;
        color: #6c757d;
        margin: 0.5rem 0 1rem 0;
        flex-shrink: 0;  /* 説明文の縮小防止 */
    }
    
    .package-grid {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem 1rem;
        align-items: flex-start;
        flex-grow: 1;  /* 残り空間を活用 */
    }

    .package-item {
        width: calc(50% - 0.5rem);
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        padding: 0.25rem 0;
        margin-bottom: 0.5rem;
    }

    .package-item .form-check {
        margin-bottom: 0;
        flex: 1;
    }

    .package-link {
        color: #007bff;
        text-decoration: none;
        font-size: 1rem;
    }

    .package-link:hover {
        color: #0056b3;
        text-decoration: underline;
    }

    .package-description {
        font-size: 0.9rem;
        color: #6c757d;
        margin-left: 1.25rem;
        margin-top: 0.1rem;
    }

    .package-dependent {
        margin-left: 1.5rem;
        font-size: 0.9rem;
        color: #6c757d;
        display: flex;
        align-items: center;
    }

    .package-dependent::before {
        content: "↳";
        display: inline-block;
        margin-right: 0.25rem;
        color: #007bff;
    }

    /* 公式レイアウト */
    .row {
        display: flex;
        line-height: 1.5;
        padding-left: 1.5rem;
        overflow: hidden;
        align-items: flex-start;
    }

    .col1 {
        display: inline-block;
        flex-shrink: 0;
        width: 8rem;
        color: #6c757d;
    }

    .col1:after {
        content: ":";
    }

    .col2 {
        display: inline-block;
        flex: 1;
        overflow: hidden;
        text-overflow: ellipsis;
        padding-left: 0.5rem;
        word-wrap: break-word;
    }

    .col2 a {
        margin-right: 1rem;
    }

    /* アイコン */
    #image-info {
        width: 1.25rem;
        content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' height='48px' viewBox='0 -2 24 24' width='48px' fill='%23000000'%3E%3Cpath d='M0 0h24v24H0z' fill='none'/%3E%3Cpath d='M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z'/%3E%3C/svg%3E");
    }

    #image-folder {
        width: 1.25rem;
        content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' height='48px' viewBox='0 -2 24 24' width='48px' fill='%23000000'%3E%3Cpath d='M0 0h24v24H0z' fill='none'/%3E%3Cpath d='M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V8h16v10z'/%3E%3C/svg%3E");
    }

    #image-link {
        width: 1.25rem;
        content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' height='24px' viewBox='0 -2 24 24' width='24px' fill='%23000000'%3E%3Cpath d='M0 0h24v24H0z' fill='none'/%3E%3Cpath d='m 6.3 17.7 c -1.2 -1.2 -1.2 -3.2 0 -4.4 L 9.10 10.5 7.8 9 4.9 12 c -2 2 -2 5 0 7 2 2 5 2 7 0 l 2.8 -2.8 -1.3 -1.3 -2.8 2.8 c -1.2 1.2 -3.2 1.2 -4.4 0 z M 10 15.5 15.5 10 14 8.5 8.5 14 Z M 12 4.9 9.18 7.8 10.5 9.1 13.4 6.3 c 1.21 -1.2 3.2 -1.2 4.4 0 1.2 1.2 1.2 3.2 0 4.4 l -2.8 2.8 1.3 1.3 2.8 -2.8 c 2 -2 2 -5 0 -7 -2 -2 -5 -2 -7 0 z'/%3E%3C/svg%3E");
    }

    .images {
        margin: 1.5rem 0;
    }

    /* summaryの階層表示 */
    #asu > summary {
        font-size: 1.3rem;
        font-weight: 500;
        cursor: pointer;
    }

    #use-package-selector-details > summary,
    #use-aios-config-details > summary {
        font-size: 1.2rem;
        font-weight: 500;
        cursor: pointer;
    }
    
    /* 特殊フィールド */
    #mape-gua-section {
        margin-top: 1rem;
    }

    /* デバイス入力セクションのスタイル */
    .device-input-section {
        margin: 0;
        background-color: #252528;
        border: 1px solid #444;
        border-radius: 0.25rem;
        overflow: visible;
        position: relative;
    }
    
    .device-input-section #models-autocomplete {
        padding: 1rem;
        background-color: transparent;
    }
    
    .device-input-section #models {
        background-color: #1a1a1d !important;
        border-color: #555;
    }
    
    .device-input-section #versions {
        background-color: #1a1a1d !important;
        border-color: #555;
    }
    
    @media (prefers-color-scheme: light) {
        .device-input-section {
            background-color: #e9ecef;
            border-color: #dee2e6;
        }
        
        .device-input-section #models,
        .device-input-section #versions {
            background-color: #ffffff !important;
            border-color: #ced4da;
        }
    }
    
    details {
        margin: 0;
        padding: 0;
    }

    details > summary {
        cursor: pointer;
        padding: 0.5rem 0;
        margin: 0;
        outline: none;
    }

    details[open] > summary {
        margin-bottom: 0.5rem;
    }
    
    #use-package-selector-details summary,
    #use-aios-config-details summary {
        font-weight: 500;
        font-size: 1.1rem;
    }

/* Postinst/UCI-defaults展開式のスタイル */
    #postinst-details summary,
    #uci-defaults-details summary {
        font-size: 1.1rem;
        font-weight: 500;
        cursor: pointer;
        padding: 0.5rem 0;
    }
    
    #postinst-details[open] summary,
    #uci-defaults-details[open] summary {
        margin-bottom: 1rem;
    }
    
    /* レスポンシブ */
    @media (max-width: 576px) {
        #models-autocomplete {
            flex-direction: column;
        }
        
        #versions {
            margin-top: 0.5rem;
        }
        
        #models {
            margin-right: 0;
        }
        
        .form-row {
            flex-direction: column;
        }
        
        .radio-group {
            flex-direction: column;
            gap: 0.5rem;
        }

        .package-item {
            width: 100%;
        }
        
        .row {
            flex-direction: column;
            padding-left: 1rem;
        }
        
        .col1 {
            width: 100%;
            margin-bottom: 0.25rem;
        }
        
        .col2 {
            padding-left: 0;
            margin-bottom: 0.5rem;
        }

        /* モバイルでのh4調整 */
        h4 {
            font-size: 1rem;
        }
    }

    /* ダークモード */
    @media (prefers-color-scheme: dark) {
        body {
            background-color: #18181b;
            color: #d0d0d0;
        }

        /* リンクのデフォルト */
        a {
            color: #64b5f6;
        }
    
        a:hover {
            color: #90caf9;
        }

        #models,
        #versions {
            background-color: #313135;
            color: #d0d0d0;
        }
        
        .form-control {
            background-color: #313135;
            color: #d0d0d0;
            border-color: #555;
        }
        
        .form-control:focus {
            background-color: #313135;
            color: #d0d0d0;
            border-color: #0080b3;
            box-shadow: 0 0 0 0.2rem rgba(0, 128, 179, 0.25);
        }
        
        .form-control:disabled {
            background-color: #313135;
            color: #d0d0d0;
            border-color: #444;
        }
        
        .autocomplete-items {
            background-color: #252528;
            border-color: #444;
        }
        
        .autocomplete-items div {
            background-color: #252528;
            border-color: #444;
        }
        
        .autocomplete-items div:hover,
        .autocomplete-active {
            background-color: #0080b3 !important;
            color: #fff;
        }
        
        .info {
            background-color: #1d4046;
            border-color: #2a5a61;
            color: #d0d0d0;
        }
        
        .asu-info {
            background-color: #1d4046;
            border-color: #2a5a61;
            color: #d0d0d0;
        }
        
        .asu-error {
            background-color: #601b21;
            border-color: #721c24;
            color: #d0d0d0;
        }
        
        .aios-section {
            background-color: #313135;
            border-color: #444;
        }

        .aios-config {
            background-color: #252528;
            border-color: #444;
        }    
        
        h4 {
            background-color: #252528;
            border-color: #444;
            color: #d0d0d0;
        }
        
        .package-category {
            background-color: #252528;
            border-color: #444;
        }
        
        .conditional-section {
            background-color: #313135 !important;
            border-color: #444 !important;
        }

        h5.section-title {
            color: #d0d0d0;
        }
        
        #asu-stderr,
        #asu-stdout {
            background-color: #252528 !important;
            color: #d0d0d0;
        }
        
        #image-info,
        #image-folder,
        #image-link {
            filter: invert(100%) sepia(9%) saturate(261%) hue-rotate(281deg) brightness(117%) contrast(100%);
        }
    } /* close @media (prefers-color-scheme: dark) */

    /* エラー詳細のpre要素 */
    .asu-error pre {
        background: #f8f8f8 !important;
        color: #333 !important;
        padding: 10px;
        margin: 10px 0;
        border-radius: 4px;
        overflow-x: auto;
        font-size: 0.9em;
        max-height: 200px;
    }

    @media (prefers-color-scheme: dark) {
        .asu-error pre {
            background: #2d2d2d !important;
            color: #f0f0f0 !important;
            border: 1px solid #444;
        }
    }
