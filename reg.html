<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ワンクリックSSH接続</title>
</head>
<body>
  <button id="oneclick">SSH接続（デフォルトゲートウェイへ）</button>

  <script>
  document.getElementById('oneclick').addEventListener('click', () => {
    // ─── ① .reg の内容を組み立て ───
    const regContent = `
Windows Registry Editor Version 5.00

[HKEY_CLASSES_ROOT\\\\sshps]
@="URL:SSHPS Protocol"
"URL Protocol"=""

[HKEY_CLASSES_ROOT\\\\sshps\\\\shell]
@="open"

[HKEY_CLASSES_ROOT\\\\sshps\\\\shell\\\\open\\\\command]
@="\\"C:\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe\\" -NoProfile -WindowStyle Hidden -Command ^
  \\"$gw=(Get-NetIPConfiguration | Where-Object { $_.IPv4DefaultGateway }).IPv4DefaultGateway.NextHop; ssh root@$gw;\\""
`.trim();

    // ─── ② Blob化してダウンロード ───
    const blob = new Blob([regContent], { type: 'application/octet-stream' });
    const a1   = document.createElement('a');
    a1.href    = URL.createObjectURL(blob);
    a1.download= 'sshps-register-gateway.reg';
    document.body.appendChild(a1);
    a1.click();
    document.body.removeChild(a1);

    // ─── ③ 同一クリックでプロトコル呼び出し ───
    const a2 = document.createElement('a');
    a2.href  = 'sshps://ignore';
    document.body.appendChild(a2);
    a2.click();
    document.body.removeChild(a2);
  });
  </script>
</body>
</html>
