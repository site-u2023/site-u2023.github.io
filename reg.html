<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>SSHPS プロトコル登録</title>
</head>
<body>
  <input id="host" type="text" placeholder="ホスト名 or ドメイン（例: myrouter.local）">
  <button id="reg-btn">SSHPS プロトコルを登録</button>

  <script>
  document.getElementById('reg-btn').addEventListener('click', () => {
    const host = document.getElementById('host').value.trim();
    if (!host) return alert('ホスト名を入力してください');

    // 1) .reg の内容を組み立て
    const regContent = `
Windows Registry Editor Version 5.00

[HKEY_CLASSES_ROOT\\sshps]
@="URL:SSHPS Protocol"
"URL Protocol"=""

[HKEY_CLASSES_ROOT\\sshps\\shell]
@="open"

[HKEY_CLASSES_ROOT\\sshps\\shell\\open\\command]
@="\\"C:\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe\\" -NoProfile -WindowStyle Hidden -Command ^
  "$dns = (Get-DnsClientServerAddress -AddressFamily IPv4)[0].ServerAddresses[0]; ^
   $ip  = (Resolve-DnsName -Name '${host}' -Server $dns).IPAddress; ^
   Start-Process ssh -ArgumentList 'root@' + $ip;""
`.trim();

    // 2) Blob を作成して a タグを生成
    const blob = new Blob([regContent], { type: 'application/octet-stream' });
    const url  = URL.createObjectURL(blob);
    const a    = document.createElement('a');

    a.href        = url;
    a.download    = `sshps-register-${host}.reg`;  // ファイル名を設定
    a.style.display = 'none';
    document.body.appendChild(a);

    // 3) 自動クリックで「名前を付けて保存 or 開く」ダイアログを出す
    a.click();

    // 4) 後片付け
    setTimeout(() => {
      URL.revokeObjectURL(url);
      document.body.removeChild(a);
    }, 1000);
  });
  </script>
</body>
</html>
