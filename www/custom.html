<!-- Extended Build Info Section - ISP情報表示 -->
<div id="extended-build-info" class="hide">
  <h3 class="tr-extended-info">Location & ISP Information</h3>
  <div class="row">
    <div class="col1 tr-notice">Notice</div>
    <div class="col2" id="auto-config-notice"></div>
  </div>
  <div class="row">
    <div class="col1 tr-country">Country</div>
    <div class="col2" id="auto-config-country"></div>
  </div>
  <div class="row">
    <div class="col1 tr-timezone">Timezone</div>
    <div class="col2" id="auto-config-timezone"></div>
  </div>
  <div class="row">
    <div class="col1 tr-zonename">Zonename</div>
    <div class="col2" id="auto-config-zonename"></div>
  </div>
  <div class="row">
    <div class="col1 tr-isp">ISP</div>
    <div class="col2" id="auto-config-isp"></div>
  </div>
  <div class="row">
    <div class="col1 tr-as">AS</div>
    <div class="col2" id="auto-config-as"></div>
  </div>
  <div class="row">
    <div class="col1 tr-ip-address">IP Address</div>
    <div class="col2" id="auto-config-ip"></div>
  </div>
  <div class="row">
    <div class="col1 tr-method">Method</div>
    <div class="col2" id="auto-config-method"></div>
  </div>
</div>

<!-- Enhanced Package Selector -->
<div id="custom-packages-section">
  <details id="packages-details">
    <summary>
      <span class="tr-packages">Installed Packages</span>
    </summary>
    <div id="package-selector-config">
      <div class="package-search-container">
        <h5>Package Search</h5>
        <p class="text-muted">Select extra packages to install. They'll be added to the list below.</p>
        <div id="package-search-autocomplete" class="autocomplete">
          <input type="text"
            id="package-search"
            placeholder="Type package name"
            autocomplete="off"
            spellcheck="false"
            autocapitalize="off">
        </div>
      </div>
      
      <div id="package-categories">
      </div>
      
      <details id="postinst-details">
        <summary>
          <span>Postinst (Package installation script)</span>
        </summary>
        <textarea
          id="asu-packages"
          autocomplete="off"
          spellcheck="false"
          autocapitalize="off"
        ></textarea>
      </details>
    </div>
  </details>
</div>

<!-- Scripts Configuration -->
<div id="custom-scripts-section">
  <details id="scripts-details">
    <summary>
      <span class="tr-defaults">Script to run on first boot (uci-defaults)</span>
    </summary>
    <div id="scripts-config">
      <div class="commands-container">
        <h5>Add commands</h5>
        <p class="text-muted">Add custom shell commands that run on first boot.</p>
        <div id="commands-autocomplete" class="autocomplete">
          <input type="text"
            id="command"
            placeholder="Type commands"
            autocomplete="off"
            spellcheck="false"
            autocapitalize="off">
        </div>
      </div>
      
      <div id="basic-config" class="config-section">
        <h5>Basic Configuration</h5>
        <div class="form-row">
          <div class="form-group">
            <label for="aios-language">Language</label>
            <select id="aios-language">
              <option value="ar">العربية (Arabic)</option>
              <option value="bg">Български (Bulgarian)</option>
              <option value="ca">Català (Catalan)</option>
              <option value="cs">Čeština (Czech)</option>
              <option value="da">Dansk (Danish)</option>
              <option value="de">Deutsch (German)</option>
              <option value="el">Ελληνικά (Greek)</option>
              <option value="en">English</option>
              <option value="es">Español (Spanish)</option>
              <option value="fi">Suomi (Finnish)</option>
              <option value="fr">Français (French)</option>
              <option value="he">עברית (Hebrew)</option>
              <option value="hu">Magyar (Hungarian)</option>
              <option value="it">Italiano (Italian)</option>
              <option value="ja">日本語 (Japanese)</option>
              <option value="ko">한국어 (Korean)</option>
              <option value="lt">Lietuvių (Lithuanian)</option>
              <option value="ms">Bahasa Melayu (Malay)</option>
              <option value="nl">Nederlands (Dutch)</option>
              <option value="no">Norsk (Norwegian)</option>
              <option value="pl">Polski (Polish)</option>
              <option value="pt">Português (Portuguese)</option>
              <option value="pt_br">Português do Brasil (Portuguese Brazil)</option>
              <option value="ro">Română (Romanian)</option>
              <option value="ru">Русский (Russian)</option>
              <option value="sk">Slovenčina (Slovak)</option>
              <option value="sv">Svenska (Swedish)</option>
              <option value="tr">Türkçe (Turkish)</option>
              <option value="uk">Українська (Ukrainian)</option>
              <option value="vi">Tiếng Việt (Vietnamese)</option>
              <option value="zh_cn">简体中文 (Chinese Simplified)</option>
              <option value="zh_tw">繁體中文 (Chinese Traditional)</option>                       
            </select>
          </div>
          <div class="form-group">
            <label for="aios-country">Country</label>
            <input type="text" id="aios-country" placeholder="00" maxlength="2">
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="aios-timezone">Timezone</label>
            <input type="text" id="aios-timezone" placeholder="UTC">
          </div>
          <div class="form-group">
            <label for="aios-zonename">Zonename</label>
            <input type="text" id="aios-zonename" placeholder="UTC">
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="aios-device-name">Device name</label>
            <input type="text" id="aios-device-name" placeholder="OpenWrt" value="">
          </div>
          <div class="form-group">
            <label for="aios-root-password">Root password</label>
            <input type="text" id="aios-root-password" placeholder="8+ characters" value="">
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="aios-lan-ipv4">LAN IPv4 Address</label>
            <input type="text" id="aios-lan-ipv4" placeholder="192.168.1.1" value="192.168.1.1">
          </div>
          <div class="form-group">
            <label for="aios-lan-ipv6">LAN IPv6 Address</label>
            <input type="text" id="aios-lan-ipv6" placeholder="fd00::1/64">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="aios-ssh-interface">SSH Interface</label>
            <input type="text" id="aios-ssh-interface" class="form-control" placeholder="lan" value="lan">
            <small class="form-text text-muted">Network interface for SSH access</small>
          </div>
          <div class="form-group">
            <label for="aios-ssh-port">SSH Port</label>
            <input type="number" id="aios-ssh-port" class="form-control" placeholder="22" value="22" min="1" max="65535">
            <small class="form-text text-muted">Port number for SSH access</small>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="aios-flow-offloading">Flow offloading type</label>
            <select id="aios-flow-offloading" class="form-control">
              <option value="">Disabled</option>
              <option value="software">Software flow offloading</option>
              <option value="hardware">Hardware flow offloading</option>
            </select>
          </div>
          <div class="form-group">
            <label for="aios-backup-path">Restore Backup Path</label>
            <input type="text" id="aios-backup-path" class="form-control" placeholder="/root/backup.tar.gz" value="/root/backup.tar.gz">
            <small class="form-text text-muted">Path to backup file for restore</small>
          </div>
        </div>
      </div>
    
      <div id="wifi-config" class="config-section">
        <h5>Wi-Fi Configuration</h5>
        <div class="form-row">
          <div class="form-group">
            <label for="aios-wifi-ssid">Wi-Fi SSID</label>
            <input type="text" id="aios-wifi-ssid" placeholder="OpenWrt" value="OpenWrt">
          </div>
          <div class="form-group">
            <label for="aios-wifi-password">Wi-Fi Password</label>
            <input type="text" id="aios-wifi-password" placeholder="8+ characters" value="password">
          </div>
        </div>
      </div>
      
      <div id="internet-config" class="config-section">
        <h5>Internet Connection</h5>
        <div class="form-group">
          <label>Connection mode</label>
          <div class="radio-group">
            <label>
              <input type="radio" name="connectionMode" value="auto" checked>
              Auto (Recommended)
            </label>
            <label>
              <input type="radio" name="connectionMode" value="manual">
              Manual
            </label>
          </div>
        </div>
        
        <div id="manual-connection-section" style="display: none;">
          <div class="form-group">
            <label>Connection type</label>
            <div class="radio-group">
              <label>
                <input type="radio" name="connectionType" value="dhcp" checked>
                DHCP
              </label>
              <label>
                <input type="radio" name="connectionType" value="pppoe">
                PPPoE
              </label>
              <label>
                <input type="radio" name="connectionType" value="dslite">
                DS-Lite
              </label>
              <label>
                <input type="radio" name="connectionType" value="mape">
                MAP-E
              </label>
              <label>
                <input type="radio" name="connectionType" value="ap">
                AP
              </label>
            </div>
          </div>
          
          <div id="pppoe-section" class="connection-config" style="display: none;">
            <div class="form-row">
              <div class="form-group">
                <label for="pppoe-username">PPPoE username</label>
                <input type="text" id="pppoe-username" placeholder="Username">
              </div>
              <div class="form-group">
                <label for="pppoe-password">PPPoE password</label>
                <input type="password" id="pppoe-password" placeholder="Password">
              </div>
            </div>
          </div>
          
          <div id="dslite-section" class="connection-config" style="display: none;">
            <h5 class="section-title">DS-Lite Configuration</h5>
            
            <div class="form-group">
              <div class="radio-group">
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="dsliteMode" id="dslite-auto" value="auto">
                  <label class="form-check-label" for="dslite-auto">Auto (Recommended)</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="dsliteMode" id="dslite-manual" value="manual" checked>
                  <label class="form-check-label" for="dslite-manual">Manual</label>
                </div>
              </div>
              <small class="text-muted" id="dslite-mode-hint">Auto not available (no AFTR detected)</small>
            </div>

            <div id="dslite-manual-fields">
              <div class="form-group">
                <label for="dslite-aftr-type">AFTR Type</label>
                <select id="dslite-aftr-type" class="form-control" onchange="applyInitialsFromApi('dslite')">
                  <option value="transix">gw.transix.jp</option>
                  <option value="xpass">gw.xpass.jp</option>
                  <option value="v6option">gw.v6option.jp</option>
                </select>
              </div>

              <div class="form-group">
                <label for="dslite-area">Region</label>
                <select id="dslite-area" class="form-control" onchange="applyInitialsFromApi('dslite')">
                  <option value="east">East Japan</option>
                  <option value="west">West Japan</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label for="dslite-aftr-address">AFTR IPv6 Address</label>
              <input type="text" id="dslite-aftr-address" class="form-control" placeholder="2404:8e00::feed:100" value="">
              <small class="form-text text-muted">Auto mode: Set from ISP detection | Manual mode: Set based on AFTR type and region</small>
            </div>
          </div>

          <div id="mape-section" class="connection-config" style="display: none;">
            <h5 class="section-title">MAP-E Configuration</h5>
            <div class="form-group">
              <div class="radio-group">
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="mapeType" id="mape-auto" value="auto">
                  <label class="form-check-label" for="mape-auto">Auto (Recommended)</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="mapeType" id="mape-gua" value="gua">
                  <label class="form-check-label" for="mape-gua">GUA</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="mapeType" id="mape-pd" value="pd">
                  <label class="form-check-label" for="mape-pd">PD</label>
                </div>
              </div>
              <small class="text-muted">
                <strong>Auto (Recommended)</strong>: Automatically retrieves MAP-E configuration
              </small>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label for="mape-br">BR (Border Relay)</label>
                <input type="text" id="mape-br" class="form-control" placeholder="2001:db8::1">
              </div>
              <div class="form-group">
                <label for="mape-ealen">EA-len</label>
                <input type="number" id="mape-ealen" class="form-control" placeholder="16" min="0" max="48">
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label for="mape-ipv4-prefix">IPv4 Prefix</label>
                <input type="text" id="mape-ipv4-prefix" class="form-control" placeholder="192.0.2.0">
              </div>
              <div class="form-group">
                <label for="mape-ipv4-prefixlen">IPv4 Prefix Length</label>
                <input type="number" id="mape-ipv4-prefixlen" class="form-control" placeholder="24" min="1" max="32">
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label for="mape-ipv6-prefix">IPv6 Prefix</label>
                <input type="text" id="mape-ipv6-prefix" class="form-control" placeholder="2001:db8:8000::">
              </div>
              <div class="form-group">
                <label for="mape-ipv6-prefixlen">IPv6 Prefix Length</label>
                <input type="number" id="mape-ipv6-prefixlen" class="form-control" placeholder="32" min="1" max="128">
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label for="mape-psid-offset">PSID Offset</label>
                <input type="number" id="mape-psid-offset" class="form-control" placeholder="4" min="0" max="16">
              </div>
              <div class="form-group">
                <label for="mape-psidlen">PSID Length</label>
                <input type="number" id="mape-psidlen" class="form-control" placeholder="6" min="0" max="16">
              </div>
            </div>

            <div id="mape-gua-section" class="form-group" style="display: none;">
              <label for="mape-gua-prefix">GUA Prefix</label>
              <input type="text" id="mape-gua-prefix" class="form-control" placeholder="2400:4151:80e2:7500::/64">
              <small class="form-text text-muted">IPv6 Global Unicast Address prefix</small>
            </div>
          </div>
          
          <div id="ap-section" class="conditional-section">
            <h5 class="section-title">AP Configuration</h5>
            <div class="form-row">
              <div class="form-group">
                <label for="ap-ip-address">IP Address</label>
                <input type="text" id="ap-ip-address" class="form-control" value="192.168.1.2">
              </div>
              <div class="form-group">
                <label for="ap-gateway">Gateway</label>
                <input type="text" id="ap-gateway" class="form-control" value="192.168.1.1">
              </div>
            </div>
          </div>

          <div class="form-group" id="isp-detection-group">
            <label>ISP Detection Status</label>
            <div id="isp-info-display" class="info" style="margin-bottom: 0;">
              <div id="isp-status-message">ISP information will be detected when configuration is opened</div>
              <div id="isp-technical-info" style="font-family: monospace; font-size: 0.9em; margin-top: 0.5rem; display: none;"></div>
            </div>
          </div>
        </div>
      </div>

      <div id="tuning-config" class="config-section">
        <h5>Tuning</h5>
        <div class="form-group">
          <label>Dynamic Network Optimizer</label>
          <div class="radio-group">
            <div class="form-check">
              <input class="form-check-input" type="radio" name="netOptimizer" id="netopt-enabled" value="enabled" checked>
              <label class="form-check-label" for="netopt-enabled">Enabled</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="netOptimizer" id="netopt-disabled" value="disabled">
              <label class="form-check-label" for="netopt-disabled">Disabled</label>
            </div>
          </div>
          <small class="form-text text-muted">Automatically optimizes TCP buffer sizes and network parameters based on available RAM</small>
        </div>

        <div id="net-optimizer-section" class="conditional-section" style="display: block;">
          <div class="form-group">
            <label>Configuration Mode</label>
            <div class="radio-group">
              <div class="form-check">
                <input class="form-check-input" type="radio" name="netOptimizerMode" id="netopt-auto" value="auto" checked>
                <label class="form-check-label" for="netopt-auto">Auto (Recommended)</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="netOptimizerMode" id="netopt-manual" value="manual">
                <label class="form-check-label" for="netopt-manual">Manual</label>
              </div>
            </div>
            <small class="form-text text-muted">Auto mode adjusts parameters based on system resources</small>
          </div>

          <div id="net-optimizer-manual" class="conditional-section">
            <div class="form-row">
              <div class="form-group">
                <label for="netopt-rmem">TCP Read Memory</label>
                <input type="text" id="netopt-rmem" class="form-control" placeholder="4096 131072 8388608">
                <small class="form-text text-muted">min default max (bytes)</small>
              </div>
              <div class="form-group">
                <label for="netopt-wmem">TCP Write Memory</label>
                <input type="text" id="netopt-wmem" class="form-control" placeholder="4096 131072 8388608">
                <small class="form-text text-muted">min default max (bytes)</small>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="netopt-conntrack">Connection Tracking Max</label>
                <input type="number" id="netopt-conntrack" class="form-control" placeholder="131072" min="1024">
              </div>
              <div class="form-group">
                <label for="netopt-backlog">Network Device Backlog</label>
                <input type="number" id="netopt-backlog" class="form-control" placeholder="5000" min="100">
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="netopt-somaxconn">Socket Max Connections</label>
                <input type="number" id="netopt-somaxconn" class="form-control" placeholder="16384" min="128">
              </div>
              <div class="form-group">
                <label for="netopt-congestion">TCP Congestion Control</label>
                <select id="netopt-congestion" class="form-control">
                  <option value="cubic" selected>cubic (default)</option>
                  <option value="bbr">bbr</option>
                  <option value="reno">reno</option>
                </select>
              </div>
            </div>
          </div>
        </div>
      </div>

      <details id="uci-defaults-details">
        <summary>
          <span>UCI-defaults (Boot configuration script)</span>
        </summary>
        <div id="uci-defaults-group">
          <textarea
            id="uci-defaults-content"
            autocomplete="off"
            spellcheck="false"
            autocapitalize="off"
          ></textarea>
        </div>
      </details>
    </div>
  </details>
</div>
