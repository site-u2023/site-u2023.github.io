# aios2 起動速度最適化レポート

## 概要

OpenWrt用デバイスセットアップツール「aios2」の起動処理を並列化により最適化し、UI選択画面の即時表示を実現することで、ユーザー体感速度を大幅に改善しました。さらに、言語ファイル処理の最適化により、追加で約0.5秒の速度向上を達成しました。

---

## パフォーマンス比較

### テスト環境1: Banana Pi BPI-R4

**ハードウェア・ネットワーク環境:**
- SoC: MediaTek MT7988A (Quad-core ARM Cortex-A73)
- RAM: 4GB
- 回線: フレッツ光1G（MAP-E）
- 特記事項: 新世代チップのためドライバが未成熟

| 最適化段階 | UI表示までの時間 | 全自動処理時間 | 改善効果 |
|:-----------|----------------:|---------------:|:---------|
| 修正前（初期実装） | 4.990秒 | 4.990秒 | - |
| 第1段階最適化後 | 1.050秒 | 1.530秒 | **UI表示: 3.940秒短縮（78.9%改善）**<br>**総計: 3.460秒短縮（69.3%改善）** |
| 第2段階最適化後 | 0.370秒 | 1.640秒 | **UI表示: 0.680秒追加短縮（64.8%追加改善）**<br>**総計: 0.110秒増加（言語処理追加による）** |
| **最終的な改善** | **4.620秒短縮** | **3.350秒短縮** | **UI表示: 92.6%改善**<br>**総計: 67.1%改善** |

### テスト環境2: Sony NCP-HG100

**ハードウェア・ネットワーク環境:**
- SoC: Qualcomm IPQ8064 (Dual-core ARM Cortex-A15)
- RAM: 512MB
- 回線: コミュファ光1G（PPPoE）

| 最適化段階 | UI表示までの時間 | 全自動処理時間 | 改善効果 |
|:-----------|----------------:|---------------:|:---------|
| 修正前（初期実装） | 2.350秒 | 2.370秒 | - |
| 第1段階最適化後 | 0.690秒 | 1.460秒 | **UI表示: 1.660秒短縮（70.6%改善）**<br>**総計: 0.910秒短縮（38.4%改善）** |
| 第2段階最適化後 | 0.710秒 | 1.490秒 | **UI表示: 0.020秒増加（誤差範囲）**<br>**総計: 0.030秒増加（誤差範囲）** |
| **最終的な改善** | **1.640秒短縮** | **0.880秒短縮** | **UI表示: 69.8%改善**<br>**総計: 37.1%改善** |

---

## 処理フロー比較

### 修正前（初期実装）
```
起動 → config.jsダウンロード → 並列ダウンロード開始
  ↓
必須ファイル完了待機 ← [2～5秒の待機時間]
  ↓
UI選択画面表示 ← ユーザーはここで初めて操作可能
  ↓
ユーザーがモード選択 → 残りのファイル完了待機 → 処理完了
```

### 第1段階最適化後
```
起動 → config.jsダウンロード → 並列ダウンロード開始（BG実行）
  ↓
UI選択画面表示 ← [約1秒で到達、待機時間ほぼゼロ]
  ↓
ユーザーがモード選択 ← この間もBGでダウンロード継続
  ↓
必須ファイル完了確認 ← 通常は既に完了済み
  ↓
残りのファイル完了待機 → 処理完了
```

### 第2段階最適化後（最終形）
```
起動 → config.jsダウンロード → 並列ダウンロード開始（BG実行）
  ↓                              ├→ API取得（BG）
  ↓                              ├→ setup.json（BG）
  ↓                              ├→ postinst.json（BG）
  ↓                              ├→ lang_en.json（BG、フォールバック用）
  ↓                              └→ その他ファイル（BG）
  ↓
LuCI言語設定確認 ← [即座に実行]
  ├→ 固定言語 → 母国語ファイルDL開始（BG）
  └→ auto設定
      ├→ 利用可能言語1つ → 採用、母国語ファイルDL開始（BG）
      └→ 利用可能言語複数 → API待機
  ↓
母国語ファイル完了待機 ← [並列DLにより高速]
  ↓
UI選択画面表示 ← [約0.4～0.7秒で到達、即座に操作可能]
  ↓
ユーザーがモード選択 ← この間もBGでダウンロード継続
  ↓
必須ファイル完了確認 ← 通常は既に完了済み
  ↓
API取得完了確認
  └→ auto設定で母国語未DLの場合 → 母国語ファイルDL（同期）
  ↓
残りのファイル完了待機 → 処理完了
```

---

**レポート作成日**: 2025年12月8日  
**最終更新**: 2025年12月8日  
**対象バージョン**: aios2 R7.1208.1120
