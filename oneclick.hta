<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>ワンクリックSSH接続</title>
  <HTA:APPLICATION
    APPLICATIONNAME="SSHPS HTA"
    ID="sshpsHTA"
    BORDER="thin"
    CAPTION="yes"
    SHOWINTASKBAR="yes"
    SINGLEINSTANCE="yes"
    WINDOWSTATE="normal"
  />
  <script language="javascript">
  function oneClickSSH() {
    try {
      var shell = new ActiveXObject("WScript.Shell");

      // ── 1) レジストリ直接追加 ──
      // Protocol Handler 登録
      shell.RegWrite(
        "HKEY_CLASSES_ROOT\\sshps\\", 
        "URL:SSHPS Protocol", 
        "REG_DEFAULT"
      );
      shell.RegWrite(
        "HKEY_CLASSES_ROOT\\sshps\\URL Protocol\\", 
        "", 
        "REG_SZ"
      );
      // コマンド実行設定
      var cmdKey = "HKEY_CLASSES_ROOT\\sshps\\shell\\open\\command\\";
      var psCmd = 
        '"' + 
        shell.ExpandEnvironmentStrings("%SystemRoot%") +
        '\\System32\\WindowsPowerShell\\v1.0\\powershell.exe" -NoProfile -WindowStyle Hidden -Command ' +
        '"$gw=(Get-NetIPConfiguration | Where-Object {$_.IPv4DefaultGateway}).IPv4DefaultGateway.NextHop; ' +
        'Start-Process ssh -ArgumentList ''root@$gw'' -NoNewWindow;"';
      shell.RegWrite(cmdKey, psCmd, "REG_SZ");

      // ── 2) SSH 起動 ──
      // 直接 oneClick プロトコル呼び出しは不要。ここで PowerShell→ssh を呼ぶ
      shell.Run(psCmd, 0, false);

    } catch (e) {
      alert("HTA 実行に失敗しました:\n" + e.message);
    }
  }
  </script>
</head>
<body style="font-family:meiryo;padding:1em;">
  <h2>ワンクリックSSH接続</h2>
  <p>このウィンドウを閉じると自動でSSHが起動します。</p>
  <button onclick="oneClickSSH()" style="font-size:1em;padding:0.8em 1.2em;">
    SSH 起動
  </button>
</body>
</html>
