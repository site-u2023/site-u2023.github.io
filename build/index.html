<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>OpenWrt Firmware Selector</title>
    <link rel="stylesheet" href="https://firmware-selector.openwrt.org/style.css">
    <script src="https://firmware-selector.openwrt.org/index.js"></script>
</head>
<body>
    <div class="wrapper">
        <h1>OpenWrt Firmware Selector</h1>
        <div class="content">
            <div class="search-container">
                <input type="text" id="models" class="form-control" placeholder="Type device model (e.g. '4/32')" autocomplete="off" autofocus>
                <div id="models-autocomplete-list" class="autocomplete-items"></div>
            </div>
            
            <div class="versions">
                <select id="versions" class="form-control">
                    <option value="" disabled selected>Select version</option>
                </select>
            </div>
            
            <div id="info" class="info"></div>
            
            <div id="images" class="images"></div>
            
            <div id="packages" class="packages">
                <div class="package-lists">
                    <div class="package-installed">
                        <h5>Installed packages</h5>
                        <div id="package-installed" class="package-list"></div>
                    </div>
                    <div class="package-available">
                        <h5>Available packages</h5>
                        <input type="text" id="package-search" placeholder="Search packages..." class="form-control">
                        <div id="package-available" class="package-list"></div>
                    </div>
                </div>
                <div class="package-input">
                    <label for="packages-custom">Packages to add/remove (one per line, prefix with '-' to remove):</label>
                    <textarea id="packages-custom" rows="3" class="form-control" placeholder="-wpad-basic-wolfssl&#10;wpad-wolfssl&#10;luci-ssl"></textarea>
                </div>
            </div>
            
            <!-- aios-light.sh configuration section -->
            <div id="script-section" class="script-section">
                <div class="script-toggle">
                    <input type="checkbox" id="use-aios-config">
                    <label for="use-aios-config">Use aios-light.sh configuration</label>
                </div>
                
                <div id="aios-config" class="aios-config" style="display: none;">
                    <h5>Basic Configuration</h5>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="aios-language">Language:</label>
                            <select id="aios-language" class="form-control">
                                <option value="en">English</option>
                                <option value="ja">Japanese</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="aios-device-name">Device name:</label>
                            <input type="text" id="aios-device-name" class="form-control" placeholder="OpenWrt-Router">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="aios-root-password">Root password:</label>
                            <input type="password" id="aios-root-password" class="form-control" placeholder="8+ characters">
                        </div>
                        <div class="form-group">
                            <label for="aios-confirm-password">Confirm password:</label>
                            <input type="password" id="aios-confirm-password" class="form-control" placeholder="Confirm password">
                        </div>
                    </div>
                    
                    <h5>Wi-Fi Configuration</h5>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="aios-wifi-ssid">Wi-Fi SSID:</label>
                            <input type="text" id="aios-wifi-ssid" class="form-control" placeholder="MyOpenWrt">
                        </div>
                        <div class="form-group">
                            <label for="aios-wifi-password">Wi-Fi password:</label>
                            <input type="password" id="aios-wifi-password" class="form-control" placeholder="8+ characters">
                        </div>
                    </div>
                    
                    <h5>Internet Connection</h5>
                    <div class="form-group">
                        <label>Connection type:</label>
                        <div class="radio-group">
                            <label class="radio-item">
                                <input type="radio" name="connectionType" value="auto" checked>
                                Auto-detect
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="connectionType" value="dhcp">
                                DHCP
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="connectionType" value="pppoe">
                                PPPoE
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="connectionType" value="dslite">
                                DS-Lite
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="connectionType" value="mape">
                                MAP-E
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="connectionType" value="none">
                                None
                            </label>
                        </div>
                    </div>
                    
                    <div id="pppoe-fields" class="conditional-fields" style="display: none;">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="pppoe-username">PPPoE username:</label>
                                <input type="text" id="pppoe-username" class="form-control" placeholder="From ISP">
                            </div>
                            <div class="form-group">
                                <label for="pppoe-password">PPPoE password:</label>
                                <input type="password" id="pppoe-password" class="form-control" placeholder="From ISP">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="script-input">
                    <label for="script">Script to run on first boot (uci-defaults):</label>
                    <textarea id="script" rows="10" class="form-control" placeholder="#!/bin/sh&#10;&#10;# Your script here"></textarea>
                </div>
            </div>
            
            <div id="build" class="build">
                <button id="build-button" class="btn btn-primary">REQUEST BUILD</button>
                <div id="build-status" class="build-status"></div>
            </div>
        </div>
    </div>
    
    <style>
        .script-toggle {
            margin-bottom: 1rem;
        }
        
        .script-toggle input[type="checkbox"] {
            margin-right: 0.5rem;
        }
        
        .aios-config {
            border: 1px solid #ddd;
            padding: 1rem;
            margin-bottom: 1rem;
            background-color: #f9f9f9;
        }
        
        .aios-config h5 {
            margin-top: 1rem;
            margin-bottom: 0.5rem;
            color: #333;
        }
        
        .aios-config h5:first-child {
            margin-top: 0;
        }
        
        .form-row {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .form-group {
            flex: 1;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.25rem;
            font-weight: 500;
        }
        
        .radio-group {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .radio-item {
            display: flex;
            align-items: center;
            margin: 0;
            font-weight: normal;
        }
        
        .radio-item input {
            margin-right: 0.5rem;
        }
        
        .conditional-fields {
            margin-top: 1rem;
            padding: 1rem;
            background-color: #e7f3ff;
            border-left: 4px solid #007bff;
        }
        
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
            }
            
            .radio-group {
                flex-direction: column;
                gap: 0.5rem;
            }
        }
    </style>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            initAiosConfig();
        });
        
        function initAiosConfig() {
            const checkbox = document.getElementById('use-aios-config');
            const config = document.getElementById('aios-config');
            const scriptTextarea = document.getElementById('script');
            
            checkbox.addEventListener('change', function() {
                if (this.checked) {
                    config.style.display = 'block';
                    generateAiosScript();
                } else {
                    config.style.display = 'none';
                    scriptTextarea.value = '';
                }
            });
            
            // Connection type change handler
            document.querySelectorAll('input[name="connectionType"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    const pppoeFields = document.getElementById('pppoe-fields');
                    if (this.value === 'pppoe') {
                        pppoeFields.style.display = 'block';
                    } else {
                        pppoeFields.style.display = 'none';
                    }
                    
                    if (checkbox.checked) {
                        generateAiosScript();
                    }
                });
            });
            
            // Auto-generate script on input changes
            document.getElementById('aios-config').addEventListener('input', function() {
                if (checkbox.checked) {
                    generateAiosScript();
                }
            });
        }
        
        function generateAiosScript() {
            const config = getAiosConfig();
            const script = buildAiosScript(config);
            document.getElementById('script').value = script;
        }
        
        function getAiosConfig() {
            return {
                language: document.getElementById('aios-language').value,
                deviceName: document.getElementById('aios-device-name').value,
                rootPassword: document.getElementById('aios-root-password').value,
                wifiSSID: document.getElementById('aios-wifi-ssid').value,
                wifiPassword: document.getElementById('aios-wifi-password').value,
                connectionType: document.querySelector('input[name="connectionType"]:checked').value,
                pppoeUsername: document.getElementById('pppoe-username').value,
                pppoePassword: document.getElementById('pppoe-password').value
            };
        }
        
        function buildAiosScript(config) {
            let script = '#!/bin/sh\n\n';
            script += '# OpenWrt Auto Configuration Script\n';
            script += '# Generated by aios-light.sh configuration\n\n';
            
            script += 'CONFIG_SCRIPT="/tmp/aios/aios-light.sh"\n';
            script += 'mkdir -p /tmp/aios\n\n';
            
            script += 'wget --no-check-certificate -O "$CONFIG_SCRIPT" "https://site-u.pages.dev/build/scripts/aios-light.sh" 2>/dev/null\n\n';
            
            script += 'if [ ! -f "$CONFIG_SCRIPT" ]; then\n';
            script += '    logger -t aios-config "Failed to download aios-light.sh"\n';
            script += '    exit 1\n';
            script += 'fi\n\n';
            
            script += 'chmod +x "$CONFIG_SCRIPT"\n\n';
            
            // Environment variables
            script += '# Configuration Variables\n';
            
            if (config.language) {
                script += `export LANGUAGE="${config.language}"\n`;
            }
            
            if (config.deviceName) {
                script += `export DEVICE_NAME="${config.deviceName}"\n`;
            }
            
            if (config.rootPassword) {
                script += `export ROOT_PASSWORD="${config.rootPassword}"\n`;
            }
            
            if (config.wifiSSID) {
                script += `export WLAN_NAME="${config.wifiSSID}"\n`;
            }
            
            if (config.wifiPassword) {
                script += `export WLAN_PASSWORD="${config.wifiPassword}"\n`;
            }
            
            // Connection type
            if (config.connectionType === 'auto') {
                script += 'export ISP_MODE=""\n';
            } else if (config.connectionType === 'pppoe') {
                script += 'export ISP_MODE="pppoe"\n';
                if (config.pppoeUsername) {
                    script += `export PPPOE_USERNAME="${config.pppoeUsername}"\n`;
                }
                if (config.pppoePassword) {
                    script += `export PPPOE_PASSWORD="${config.pppoePassword}"\n`;
                }
            } else {
                script += `export ISP_MODE="${config.connectionType}"\n`;
            }
            
            script += '\n# Execute configuration script\n';
            script += 'exec sh "$CONFIG_SCRIPT" "$ISP_MODE"\n';
            
            return script;
        }
    </script>
</body>
</html>
